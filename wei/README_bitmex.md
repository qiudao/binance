# BitMEX 历史交易记录下载工具

这个工具用于下载BitMEX账户的所有历史交易记录，并保存为CSV格式。

## 功能特性

- ✅ 完整下载所有历史交易记录
- ✅ 增量更新模式（只下载新交易）
- ✅ 自动分页处理
- ✅ 防止重复记录
- ✅ 详细交易信息（21个字段）
- ✅ API速率限制保护

## 使用方法

### 方式一：使用 Makefile（推荐）

```bash
# 查看帮助
make help

# 首次下载所有历史记录
make download

# 增量更新（只下载新记录）
make update

# 列出所有CSV文件
make list

# 备份最新的CSV文件
make backup

# 删除所有CSV文件
make clean
```

### 方式二：直接运行 Go 程序

#### 1. 首次下载（全量）

首次使用时，下载所有历史交易记录：

```bash
go run bitmex_data.go
```

这将创建一个新的CSV文件，文件名格式为：`bitmex_executions_YYYYMMDD_HHMMSS.csv`

#### 2. 增量更新

后续有新交易时，使用增量更新模式只下载新记录：

```bash
go run bitmex_data.go --update
```

增量更新功能：
- 自动查找最新的CSV文件
- 读取最后一条记录的时间戳
- 只下载该时间之后的新交易
- 追加到现有文件（不创建新文件）
- 自动过滤重复记录

## CSV文件字段说明

CSV文件包含以下字段：

| 字段名 | 说明 |
|--------|------|
| ExecID | 执行ID |
| OrderID | 订单ID |
| ClOrdID | 客户端订单ID |
| Account | 账户编号 |
| Symbol | 交易对（如XBTUSD） |
| Side | 交易方向（Buy/Sell） |
| LastQty | 本次成交数量 |
| LastPx | 本次成交价格 |
| OrderQty | 订单总数量 |
| Price | 订单价格 |
| LeavesQty | 剩余未成交数量 |
| CumQty | 累计成交数量 |
| AvgPx | 平均成交价格 |
| Commission | 手续费 |
| TransactTime | 交易时间 |
| Timestamp | 时间戳 |
| OrdType | 订单类型 |
| ExecType | 执行类型 |
| OrdStatus | 订单状态 |
| Currency | 货币 |
| Text | 备注信息 |

## 示例输出

```
=== BitMEX 历史交易记录下载工具 ===

测试API连接...
✓ API连接成功!

运行模式: 增量更新
找到现有文件: bitmex_executions_20251125_122001.csv
最后记录时间: 2025-11-25T12:00:00.343Z

开始下载增量交易记录（从 2025-11-25T12:00:00.343Z 之后）...
正在获取记录 0-500...
  已获取 1 条记录，总计: 1 条
✓ 已到达最后一页
过滤重复记录后剩余: 0 条

✓ 没有新的交易记录
```

## 注意事项

1. **API限流**：程序已内置500ms延迟，避免触发API速率限制
2. **数据完整性**：增量更新会自动过滤重复记录
3. **文件大小**：约17万条记录的CSV文件大小约43MB
4. **下载时间**：首次全量下载约2-3分钟（取决于记录数量和网络速度）
5. **增量更新**：通常几秒钟完成，取决于新交易数量

## 技术细节

- 使用BitMEX REST API v1
- 支持HMAC-SHA256签名认证
- 每次请求最多500条记录（API限制）
- 自动处理分页
- 使用Go标准库，无外部依赖

## 常见问题

**Q: 如何知道是否有新交易？**
A: 运行增量更新命令，如果没有新记录会提示"没有新的交易记录"

**Q: 可以指定下载特定时间段的交易吗？**
A: 当前版本不支持，但可以通过修改代码添加该功能

**Q: CSV文件可以在Excel中打开吗？**
A: 可以，CSV格式兼容所有主流表格软件

**Q: 增量更新会修改原文件吗？**
A: 是的，新记录会追加到文件末尾，不会覆盖原有数据
